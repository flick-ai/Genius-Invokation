<html>
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <py-env>
      - './genius_invocation-0.0.1-py3-none-any.whl'
      - numpy
      - './loguru-0.7.2-py3-none-any.whl'
      - './rich-13.6.0-py3-none-any.whl'
    </py-env>
  </head>
  <body>

    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script> -->
    <py-script>
      <!-- from typing import Iterable
      from sys import stdout, modules
      from contextlib import contextmanager

      from rich import get_console
      from rich.console import _is_jupyter
      from rich.segment import Segment
      import rich.jupyter

      from pyodide import JsException
      from js import console -->
      from genius_invocation import main
      <!-- def display_pyscript(segments: Iterable[Segment], text: str) -> None:
          """Allow output of raw HTML within pyscript/pyodide"""
          html = rich.jupyter._render_segments(segments)
          stdout.write(html)

      #patch jupyter display method to write processed HTML to stdout
      rich.jupyter.display = display_pyscript 

      stdout.flush = lambda: None

      ##---- Redefine Pyscript.write()---
      class output_buffer():
          """ A (inefficient) buffer to capture stdout to a string """
          def __init__(self):
              self._internal_buffer = ''

          def write(self, value: any):
              if len(self._internal_buffer):
                  self.internal_buffer += '<br>'
              self._internal_buffer += value

          def read(self):
              return self._internal_buffer

          def flush(self):
              pass

      @contextmanager
      def stdout_to_buffer(el:Element, append: bool) -> None:
          """ A context manager to manage an output_buffer, writes to an Element on closure"""
          global stdout #Usually Pyscript OutputCTXManager at this pont
          _old_stdout = stdout
          stdout = output_buffer()
          try:
              yield
          finally:
              el._write(stdout.read(), append)
              stdout = _old_stdout 

      Element._write = Element.write

      #Allow Element.write() to take an object from rich
      def newWrite(self, value, append: bool =False) -> None:
          """ A Monkeypatched version of Pyscript's Element.write(), auto-transforming Rich objects and rendering standard objects. """
          if isinstance(value, (str, Exception, JsException)):
              self._write(value, append)
          else:
              with stdout_to_buffer(self, append):
                  get_console().print(value)

      Element.write = newWrite -->
      main.main()
    </py-script>
    <py-terminal id="terminal"></py-terminal>
    
  </body>
</html>